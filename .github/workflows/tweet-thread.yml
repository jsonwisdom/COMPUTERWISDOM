name: Post Tweet Thread

on:
  push:
    paths:
      - "tweets/*.md"

jobs:
  tweet-thread:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install tweepy markdown

      - name: Run tweet script
        env:
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        run: |
          python - <<EOF
import os
import tweepy

auth = tweepy.OAuth1UserHandler(
    os.environ["TWITTER_API_KEY"],
    os.environ["TWITTER_API_SECRET"],
    os.environ["TWITTER_ACCESS_TOKEN"],
    os.environ["TWITTER_ACCESS_SECRET"]
)
api = tweepy.API(auth)

with open("tweets/2025-05-10_firewall_breach.md", "r") as f:
    lines = f.read().split("\n\n")
    first = api.update_status(lines[0])
    for line in lines[1:]:
        first = api.update_status(line, in_reply_to_status_id=first.id)
EOF
